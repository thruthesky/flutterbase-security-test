rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 기본적으로 모든 읽기와 쓰기를 막는다.
    match /{document=**} {
      allow read: if false;
      allow write: if false;
    }
    // 사용자
    match /users/{uid} {
      // 로그인을 했으면, 도큐먼트 생성 가능
      allow create: if request.auth.uid != null;
      // 자신의 도큐먼트이면 읽기/수정 가능.
      allow read, update: if request.auth.uid == uid;
      // 삭제는 불가능
      allow delete: if false;
    }

    // 글
    match /posts/{postId} {
      // 로그인을 했으면, 도큐먼트 생성 가능
      allow create: if request.auth.uid != null;

      // 아무나 글을 읽거나 목록 할 수 있음.
      allow read: if true;

      // 수정/삭제는 자기 글만 가능.
      allow update, delete: if request.resource.data.uid == request.auth.uid
        && resource.data.uid == request.auth.uid;
    }
  }
}